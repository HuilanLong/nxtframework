(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-08128b37"],{"0fd0":function(t,e,i){"use strict";var n=i("2e2c"),r=i.n(n);r.a},"2e2c":function(t,e,i){},"587f":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app-container"},[i("el-card",{staticStyle:{"margin-top":"10px"}},[i("el-form",{attrs:{"label-position":"top","label-width":"80px",model:t.formLabelAlign}},[i("el-form-item",{attrs:{label:"标题"}},[i("el-input",{model:{value:t.formLabelAlign.product_name,callback:function(e){t.$set(t.formLabelAlign,"product_name",e)},expression:"formLabelAlign.product_name"}})],1),t._v(" "),i("el-form-item",[i("el-select",{attrs:{placeholder:"请选择"},model:{value:t.formLabelAlign.category_id,callback:function(e){t.$set(t.formLabelAlign,"category_id",e)},expression:"formLabelAlign.category_id"}},t._l(t.category_list,(function(t){return i("el-option",{key:t.category_id,attrs:{label:t.category_name_display,value:t.category_id}})})),1),t._v(" "),i("router-link",{attrs:{to:"/product/kind"}},[i("el-button",[t._v("类别管理")])],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"副标题（营销性文字）"}},[i("el-input",{model:{value:t.formLabelAlign.product_subtitle,callback:function(e){t.$set(t.formLabelAlign,"product_subtitle",e)},expression:"formLabelAlign.product_subtitle"}})],1),t._v(" "),i("el-card",{staticStyle:{"margin-bottom":"10px"},attrs:{shadow:"never"}},[i("el-form-item",[t._v("\n          价格\n          "),i("el-input",{staticStyle:{width:"220px"},model:{value:t.formLabelAlign.price,callback:function(e){t.$set(t.formLabelAlign,"price",e)},expression:"formLabelAlign.price"}}),t._v(" "),i("el-checkbox",{model:{value:t.price_negotiation,callback:function(e){t.price_negotiation=e},expression:"price_negotiation"}},[t._v("是否面议")])],1),t._v(" "),i("el-form-item",[t._v("\n          价格说明\n          "),i("el-input",{staticStyle:{width:"500px"},model:{value:t.formLabelAlign.price_remark,callback:function(e){t.$set(t.formLabelAlign,"price_remark",e)},expression:"formLabelAlign.price_remark"}})],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"产品属性"}},[i("el-card",{attrs:{shadow:"never"}},[t._l(t.formLabelAlign.product_sku,(function(e,n){return i("el-form-item",{key:n,attrs:{label:e.name}},[t._l(e.sku,(function(n,r){return i("el-tag",{key:r,attrs:{closable:"","disable-transitions":!1},on:{close:function(i){return t.handleColorClose(e.name,n)}}},[t._v("\n              "+t._s(n)+"\n            ")])})),t._v(" "),i("el-input",{ref:"saveColorTagInput",refInFor:!0,staticClass:"input-new-tag",attrs:{size:"small"},model:{value:e[n],callback:function(i){t.$set(e,n,i)},expression:"item[index]"}}),t._v(" "),i("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:function(i){return t.handleConfirm(e.name,e[n])}}},[t._v("增加")])],2)})),t._v(" "),i("el-card",{attrs:{shadow:"never"}},[i("el-form-item",{attrs:{label:"属性名称"}},[t._l(t.attributeNameTags,(function(e,n){return i("el-tag",{key:n,attrs:{closable:"","disable-transitions":!1},on:{close:function(i){return t.handleAttributeNameClose(e)}}},[t._v("\n                "+t._s(e)+"\n              ")])})),t._v(" "),i("el-input",{ref:"saveAttributeNameTagInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:t.handleInputConfirm},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleInputConfirm(e)}},model:{value:t.AttributeNameinputValue,callback:function(e){t.AttributeNameinputValue=e},expression:"AttributeNameinputValue"}}),t._v(" "),i("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:t.showAttributeNameInput}},[t._v("添加属性")])],2)],1)],2)],1),t._v(" "),i("el-form-item",{attrs:{label:"产品图片"}},[i("div",{staticClass:"box"},[i("draggable",t._b({staticClass:"list-group",attrs:{tag:"ul"},on:{start:function(e){t.productForm.drag=!0},end:function(e){t.productForm.drag=!1}},model:{value:t.productForm.productPicList,callback:function(e){t.$set(t.productForm,"productPicList",e)},expression:"productForm.productPicList"}},"draggable",t.dragOptions,!1),t._l(t.productForm.productPicList,(function(e,n){return i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.productForm.loadingapp,expression:"productForm.loadingapp"}],key:n,staticClass:"img-wrapper divBox",on:{mouseenter:function(e){return t.showDelBtn(n)},mouseleave:t.hiddenDelBtn}},[e?i("img",{staticClass:"imgSty",attrs:{src:e,width:"148",height:"148"}}):t._e(),t._v(" "),i("div",{class:{mask:n===t.productForm.currentDelBtn}}),t._v(" "),i("i",{directives:[{name:"show",rawName:"v-show",value:n===t.productForm.currentDelBtn,expression:"index===productForm.currentDelBtn"}],staticClass:"el-icon-delete delIcon",on:{click:function(i){return t.deleImg(e,n)}}})])})),0),t._v(" "),i("el-upload",{attrs:{"show-file-list":!1,action:"","list-type":"picture-card","http-request":t.handleUploadHttpRequest,"on-success":t.handlePictureSuccess}},[i("i",{staticClass:"el-icon-plus"})])],1)]),t._v(" "),i("el-form-item",{staticStyle:{"margin-bottom":"30px"}},[i("Tinymce",{ref:"editor",attrs:{height:400},model:{value:t.formLabelAlign.product_description,callback:function(e){t.$set(t.formLabelAlign,"product_description",e)},expression:"formLabelAlign.product_description"}})],1),t._v(" "),i("el-form-item",[i("el-upload",{staticClass:"pic upload-demo",attrs:{action:"/api/admin/upload/public_pic","list-type":"picture-card",headers:t.headers,"show-file-list":!1,"on-success":t.UploadOnSuccess,"before-upload":t.beforeAvatarUpload}},[i("el-button",[t._v("上传插入图片")])],1)],1),t._v(" "),i("el-form-item",[i("el-checkbox",{model:{value:t.formLabelAlign.is_recommend,callback:function(e){t.$set(t.formLabelAlign,"is_recommend",e)},expression:"formLabelAlign.is_recommend"}},[t._v("推荐")])],1),t._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:t.handleUpdate}},[t._v("发布")])],1)],1)],1)],1)},r=[],o=(i("a481"),i("7f7f"),i("6b54"),i("ac6a"),i("96cf"),i("3b8d")),a=i("db72"),c=(i("c5f6"),i("8256")),s=i("c4c8"),l=i("2f62"),u=i("5f87"),d=i("1980"),p=i.n(d),m={components:{Tinymce:c["a"],draggable:p.a},props:{id:{type:[Number,String],default:0}},data:function(){return{radio2:"1",checked:!1,formLabelAlign:{id:0,product_name:"",product_description:"",category_id:"",is_recommend:!1,product_picture_list:[],product_subtitle:"",price:"",price_negotiation:"0",price_remark:"",product_sku:[]},headers:{token:Object(u["a"])(),user_id:Object(u["b"])()},imageUrl:"",dialogVisible:!1,productForm:{productPicList:[],currentDelBtn:-1,loadingapp:!1,drag:!1,productObj:[]},colorTags:[],sizeTags:[],attributeNameTags:[],price_negotiation:!1,dynamicTags:["标签一","标签二","标签三"],SizeinputVisible:!1,ColorinputVisible:!1,AttributeNameinputVisible:!1,SizeinputValue:"",ColorinputValue:"",AttributeNameinputValue:"",inputValue:""}},computed:Object(a["a"])(Object(a["a"])({},Object(l["c"])({category_list:function(t){return t.product.CategoryListData},"productForm.productPicList":function(t){return t.product.picList}})),{},{dragOptions:function(){return{animation:200,group:"description",disabled:!1,ghostClass:"ghost"}}}),created:function(){this.load()},methods:{load:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(){var e,i,n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.$store.state.product.ListData,console.log(e),i=this,e.map((function(t){t.id==i.id&&(i.formLabelAlign.id=t.id,i.formLabelAlign.product_name=t.productName,i.formLabelAlign.product_description="测试",i.formLabelAlign.category_id=0===t.categoryId?"":t.categoryId,i.formLabelAlign.is_recommend=!!t.isRecommend)})),this.productForm.productObj={},this.productForm.productPicList=[],t.next=8,this.$store.dispatch("product/getDetail",this.id);case 8:return t.next=10,this.$store.dispatch("product/getCategory");case 10:return t.next=12,this.$store.dispatch("product/getProductPictureList",this.id);case 12:for(n in this.formLabelAlign.product_description=this.$store.state.product.Detail,this.productForm.productObj=this.$store.state.product.PicList,this.productForm.productObj)this.productForm.productPicList.push(this.productForm.productObj[n].url);r=this.$store.state.product.allDetail,i.price_negotiation=1===r.priceNegotiation,i.formLabelAlign.product_subtitle=r.productSubtitle,i.formLabelAlign.price=r.price,i.formLabelAlign.price_remark=r.priceRemark,i.formLabelAlign.product_sku=r.product_sku;case 21:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),handleUpdate:function(){var t=this;this.formLabelAlign.is_recommend=this.formLabelAlign.is_recommend?1:0,this.formLabelAlign.product_picture_list=[],this.productForm.productPicList.forEach((function(e){t.productForm.productObj.forEach((function(i){e===i.url&&t.formLabelAlign.product_picture_list.push(i.id)}))}));var e=new FormData;e.append("id",this.id),e.append("category_id",this.formLabelAlign.category_id),e.append("product_name",this.formLabelAlign.product_name),e.append("product_description",this.formLabelAlign.product_description),e.append("is_recommend",this.formLabelAlign.is_recommend);var i="["+this.formLabelAlign.product_picture_list.toString()+"]";e.append("product_picture_list",i);for(var n="",r=0;r<this.formLabelAlign.product_sku.length;r++){var o=this.formLabelAlign.product_sku[r];n=r!==this.formLabelAlign.product_sku.length-1?n+'{"name":"'+o.name+'",sku:["'+o.sku.join('","')+'"]},':n+'{"name":"'+o.name+'",sku:["'+o.sku.join('","')+'"]}'}e.append("product_sku","["+n+"]"),e.append("price",this.formLabelAlign.price),e.append("price_negotiation",this.price_negotiation?"1":"0"),e.append("price_remark",this.formLabelAlign.price_remark),e.append("product_subtitle",this.formLabelAlign.product_subtitle),this.$store.dispatch("product/updateProduct",e),this.$router.replace({path:"/product/product"})},handleAvatarSuccess:function(t,e){this.imageUrl=URL.createObjectURL(e.raw)},beforeAvatarUpload:function(t){return!0},handleColorClose:function(t,e){this.formLabelAlign.product_sku.forEach((function(i){i.name!==t||i.sku.splice(i.sku.indexOf(e),1)}))},handleAttributeNameClose:function(t){this.attributeNameTags.splice(this.attributeNameTags.indexOf(t),1)},showAttributeNameInput:function(){var t=this;this.AttributeNameinputVisible=!0,this.$nextTick((function(e){t.$refs.saveAttributeNameTagInput.$refs.input.focus()}))},showColorInput:function(){var t=this;this.ColorinputVisible=!0,this.$nextTick((function(e){t.$refs.saveColorTagInput.$refs.input.focus()}))},handleConfirm:function(t,e){e&&this.formLabelAlign.product_sku.forEach((function(i){i.name!==t||i.sku.push(e)}))},handleSizeInputConfirm:function(){var t=this.SizeinputValue;t&&this.sizeTags.push(t),this.SizeinputVisible=!1,this.SizeinputValue=""},handleInputConfirm:function(){var t=this.AttributeNameinputValue;t&&this.formLabelAlign.product_sku.push({name:t,sku:[]}),this.AttributeNameinputVisible=!1,this.AttributeNameinputValue=""},handleCreate:function(){var t=this;this.formLabelAlign.is_recommend=this.formLabelAlign.is_recommend?1:0,this.formLabelAlign.product_picture_list=[],this.productForm.productPicList.forEach((function(e){t.productForm.productObj.forEach((function(i){e===i.url&&t.formLabelAlign.product_picture_list.push(i.id)}))})),console.log(this.formLabelAlign),this.$store.dispatch("product/createProduct",this.formLabelAlign)},handleUploadHttpRequest:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(e){var i,n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=e.file,n=new FormData,n.append("file",i),t.next=5,Object(s["m"])(n);case 5:r=t.sent,0===r.status?(this.$notify({title:"提示信息",message:"图片上传成功",type:"success",duration:2e3}),this.productForm.productPicList.push(r.url),this.productForm.productObj.push({id:r.id,url:r.url})):this.$notify({title:"提示信息",message:r.message,type:"error",duration:2e3});case 7:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),UploadOnSuccess:function(t,e,i){this.$refs.editor.imageSuccessCBK([{url:t.url}]),this.$forceUpdate()},showDelBtn:function(t){this.productForm.currentDelBtn=t},hiddenDelBtn:function(){this.productForm.currentDelBtn=-1},deleImg:function(t,e){this.productForm.productPicList.splice(e,1)},handlePictureSuccess:function(t,e,i){var n="image/jpeg"===e.raw.type,r="image/jpg"===e.raw.type,o="image/png"===e.raw.type,a="image/gif"===e.raw.type;if(n||r||o||a){var c=this;new Promise((function(t,i){var n=window.URL||window.webkitURL,r=new Image;r.src=n.createObjectURL(e.raw)})).then((function(){return c.productForm.productPicList.push(e.response.data),e.raw}))}else this.$message.warning("只支持jpg或png或gif格式图片")}}},f=m,h=(i("0fd0"),i("2877")),g=Object(h["a"])(f,n,r,!1,null,"53cffb00",null);e["default"]=g.exports},8256:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"tinymce-container",class:{fullscreen:t.fullscreen},style:{width:t.containerWidth}},[i("textarea",{staticClass:"tinymce-textarea",attrs:{id:t.tinymceId}}),t._v(" "),i("div",{staticClass:"editor-custom-btn-container"})])},r=[],o=(i("ac6a"),i("c5f6"),["advlist anchor autolink autosave code codesample colorpicker colorpicker contextmenu directionality emoticons fullscreen hr image imagetools insertdatetime link lists media nonbreaking noneditable pagebreak paste preview print save searchreplace spellchecker tabfocus table template textcolor textpattern visualblocks visualchars wordcount"]),a=o,c=["searchreplace bold italic underline strikethrough alignleft aligncenter alignright outdent indent  blockquote undo redo removeformat subscript superscript code codesample","hr bullist numlist link image charmap preview anchor pagebreak insertdatetime media table emoticons forecolor backcolor fullscreen"],s=c,l=i("2d63"),u=[];function d(){return window.tinymce}var p=function(t,e){var i=document.getElementById(t),n=e||function(){};if(!i){var r=document.createElement("script");r.src=t,r.id=t,document.body.appendChild(r),u.push(n);var o="onload"in r?a:c;o(r)}function a(e){e.onload=function(){this.onerror=this.onload=null;var t,i=Object(l["a"])(u);try{for(i.s();!(t=i.n()).done;){var n=t.value;n(null,e)}}catch(r){i.e(r)}finally{i.f()}u=null},e.onerror=function(){this.onerror=this.onload=null,n(new Error("Failed to load "+t),e)}}function c(t){t.onreadystatechange=function(){if("complete"===this.readyState||"loaded"===this.readyState){this.onreadystatechange=null;var e,i=Object(l["a"])(u);try{for(i.s();!(e=i.n()).done;){var n=e.value;n(null,t)}}catch(r){i.e(r)}finally{i.f()}u=null}}}i&&n&&(d()?n(null,i):u.push(n))},m=p,f="https://cdn.jsdelivr.net/npm/tinymce-all-in-one@4.9.3/tinymce.min.js",h={name:"Tinymce",props:{id:{type:String,default:function(){return"vue-tinymce-"+ +new Date+(1e3*Math.random()).toFixed(0)}},value:{type:String,default:""},toolbar:{type:Array,required:!1,default:function(){return[]}},menubar:{type:String,default:"file edit insert view format table"},height:{type:[Number,String],required:!1,default:360},width:{type:[Number,String],required:!1,default:"auto"}},data:function(){return{hasChange:!1,hasInit:!1,tinymceId:this.id,fullscreen:!1,languageTypeList:{en:"en",zh:"zh_CN",es:"es_MX",ja:"ja"}}},computed:{containerWidth:function(){var t=this.width;return/^[\d]+(\.[\d]+)?$/.test(t)?"".concat(t,"px"):t}},watch:{value:function(t){var e=this;!this.hasChange&&this.hasInit&&this.$nextTick((function(){return window.tinymce.get(e.tinymceId).setContent(t||"")}))}},mounted:function(){this.init()},activated:function(){window.tinymce&&this.initTinymce()},deactivated:function(){this.destroyTinymce()},destroyed:function(){this.destroyTinymce()},methods:{init:function(){var t=this;m(f,(function(e){e?t.$message.error(e.message):t.initTinymce()}))},initTinymce:function(){var t=this,e=this;window.tinymce.init({selector:"#".concat(this.tinymceId),language:this.languageTypeList["en"],height:this.height,body_class:"panel-body ",object_resizing:!1,toolbar:this.toolbar.length>0?this.toolbar:s,menubar:this.menubar,plugins:a,end_container_on_empty_block:!0,powerpaste_word_import:"clean",code_dialog_height:450,code_dialog_width:1e3,advlist_bullet_styles:"square",advlist_number_styles:"default",imagetools_cors_hosts:["www.tinymce.com","codepen.io"],default_link_target:"_blank",link_title:!1,nonbreaking_force_tab:!0,init_instance_callback:function(i){e.value&&i.setContent(e.value),e.hasInit=!0,i.on("NodeChange Change KeyUp SetContent",(function(){t.hasChange=!0,t.$emit("input",i.getContent())}))},setup:function(t){t.on("FullscreenStateChanged",(function(t){e.fullscreen=t.state}))},convert_urls:!1})},destroyTinymce:function(){var t=window.tinymce.get(this.tinymceId);this.fullscreen&&t.execCommand("mceFullScreen"),t&&t.destroy()},setContent:function(t){window.tinymce.get(this.tinymceId).setContent(t)},getContent:function(){window.tinymce.get(this.tinymceId).getContent()},imageSuccessCBK:function(t){var e=this;t.forEach((function(t){window.tinymce.get(e.tinymceId).insertContent('<img class="wscnph" src="'.concat(t.url,'" >'))}))}}},g=h,b=(i("b19f"),i("2877")),_=Object(b["a"])(g,n,r,!1,null,"3a4cd6c3",null);e["a"]=_.exports},b19f:function(t,e,i){"use strict";var n=i("f218"),r=i.n(n);r.a},f218:function(t,e,i){}}]);